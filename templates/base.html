<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Document</title>
</head>

<body>
    <header>
        <nav>
            <div class="nav-wrapper">
                <a href="{{ url_for('home_page') }}" class="brand-logo">MUSICSHARE</a>
                <ul class="right hide-on-med-and-down">
                    <li>
                        <form id="search-form" action="" class="browser-default right">
                            <input id="search-input" placeholder="Search" type="text"
                                class="browser-default search-field" name="q" value="" autocomplete="off"
                                aria-label="Search box">
                            <label for="search-input"><i class="material-icons search-icon">search</i></label>
                            <i class="material-icons search-close-icon">cancel</i>
                            <div class="search-popup">
                                <div class="search-content">
                                    <label class="search-heading">Most Visited</label>
                                    <ul class="popup-list">
                                        <li class=""><a class="grey-text" href="#">Google</a></li>
                                        <li class=""><a class="grey-text" href="#">Apple</a></li>
                                        <li class=""><a class="grey-text" href="#">Microsoft</a></li>
                                        <li class=""><a class="grey-text" href="#">Github</a></li>
                                    </ul>
                                </div>
                            </div>
                        </form>
                    </li>
                    <li><a href="{{ url_for('add_song') }}"><i class="material-icons">library_music</i></a></li>
                    <li><a href="collapsible.html"><i class="material-icons">refresh</i></a></li>
                    <li><a href="mobile.html"><i class="material-icons">more_vert</i></a></li>
                </ul>
                <ul class="sidenav" id="mobile-demo">
                    <li><a href="sass.html">Sass</a></li>
                    <li><a href="badges.html">Components</a></li>
                    <li><a href="collapsible.html">Javascript</a></li>
                    <li><a href="mobile.html">Mobile</a></li>
                </ul>
            </div>
        </nav>
    </header>
    {% block content %}
    {% endblock %}
    <footer class="page-footer">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">Footer Content</h5>
                    <p class="grey-text text-lighten-4">You can use rows and columns here to organize your footer
                        content.</p>
                </div>
                <div class="col l4 offset-l2 s12">
                    <h5 class="white-text">Links</h5>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
                © 2020 Emil Öhlund
            </div>
        </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        M.AutoInit();

        // Delay Button display for effect
        document.addEventListener("DOMContentLoaded", function () {
            let box = document.getElementById("scale");
            setTimeout(function () {
                box.classList.add("scale-in");
            }, 500);
        });

        /* hide when expanded*/
        document.querySelector(".search-field").addEventListener("focus", function () {
            let hidden = document.querySelectorAll(".search-hide");

            for (let i = 0; i < hidden.length; ++i) {
                hidden[i].style.display = "none";
            }
        });

        /* show when expanded*/
        document
            .querySelector(".search-field")
            .addEventListener("focusout", function () {
                let hidden = document.querySelectorAll(".search-hide");
                for (let i = 0; i < hidden.length; ++i) {
                    hidden[i].style.display = "block";
                }
            });




        // Event listener for keypress in search box/open
        document.getElementById('search-input').addEventListener('keyup', searchEngine);
        document.getElementById('search-input').addEventListener('focus', searchEngine);


        // Local Search Engine *Basic
        function searchEngine(e) {

            let input = document.getElementById('search-input');
            let html = '';
            let matchingResults = [];
            let heading = document.querySelector('.search-heading');

            //   Find Matching Results
            if (input.value === '') {

                searchResults.forEach(function (obj) {
                    heading.textContent = 'Most Visited';

                    if (obj.frequent === true) {
                        matchingResults.push(obj);
                    }
                })
            } else {

                heading.textContent = 'Search Results';
                searchResults.forEach(function (obj) {
                    if (obj.title.toUpperCase().includes(input.value.toUpperCase())) {
                        matchingResults.push(obj);
                    }
                })
            }



            if (matchingResults.length > 0) {

                matchingResults.forEach(function (el) {
                    html += `<li><a class="grey-text" href="${el.link}">${boldString(el.title, input.value)}</a></li>`
                })
                document.querySelector('.popup-list').innerHTML = html;
            } else {
                html = `<li>There are no suggestions for your query.</li>`
                document.querySelector('.popup-list').innerHTML = html;
            }

        }

        // Help bold matching results
        function boldString(str, find) {
            var re = new RegExp(find, 'i');
            find = re.exec(str);
            return str.replace(re, '<b>' + find + '</b>');
        }
    </script>
</body>

</html>